/**
 * 366成語拆解謎題.js (完整版)
 * 包含：366題成語庫、釋義、遞迴深度拆字邏輯
 */

// ==========================================
// 1. 成語資料庫 (格式：w=成語, m=釋義)
// 這裡列出精選成語，程式會自動循環補足至 366 題
// ==========================================
const rawIdiomList = [
    { w: "一元復始", m: "指新的一年開始。如：「一元復始，萬象更新。」" },
    { w: "大刀闊斧", m: "比喻處事剛果斷絕，魄力十足。" },
    { w: "三思而行", m: "反覆考慮後再做。形容行事謹慎。" },
    { w: "力爭上游", m: "努力求取上進。比喻奮發向上，不甘落後。" },
    { w: "亡羊補牢", m: "比喻犯錯後及時更正，尚能補救。" },
    { w: "井底之蛙", m: "比喻見識淺薄的人。" },
    { w: "不遺餘力", m: "把全部力量都使出來，一點都不保留。" },
    { w: "天馬行空", m: "比喻才思敏捷，豪放不羈。" },
    { w: "手不釋卷", m: "手中總是拿著書卷。形容勤奮好學。" },
    { w: "未雨綢繆", m: "比喻事先預備，防患未然。" },
    { w: "瓜田李下", m: "比喻容易引起嫌疑的場合。" },
    { w: "目光如豆", m: "形容目光短淺，見識狹窄。" },
    { w: "四海為家", m: "形容志在四方，或漂泊無定所。" },
    { w: "左右逢源", m: "比喻辦事得心應手，或處事圓滑。" },
    { w: "出爾反爾", m: "你怎麼對待別人，別人也會怎麼對待你。後指說話不講信用，反覆無常。" },
    { w: "功虧一簣", m: "比喻事情只差最後一步而失敗。" },
    { w: "包羅萬象", m: "內容豐富，應有盡有。" },
    { w: "半途而廢", m: "事情沒做成功就停止。比喻做事有始無終。" },
    { w: "本末倒置", m: "比喻不知輕重，顛倒事理。" },
    { w: "老馬識途", m: "比喻有經驗的人對情況熟悉，能起引導作用。" },
    { w: "同舟共濟", m: "比喻同心協力，戰勝困難。" },
    { w: "名列前茅", m: "形容成績優異，排名在前面。" },
    { w: "因材施教", m: "依據學生的資質，給予不同的教導。" },
    { w: "回味無窮", m: "形容事後細細體會，越想越有意思。" },
    { w: "守口如瓶", m: "形容嚴守祕密。" },
    { w: "安居樂業", m: "形容生活安定，工作愉快。" },
    { w: "自相矛盾", m: "比喻言語或行事前後不一致。" },
    { w: "杞人憂天", m: "比喻不必要的憂慮。" },
    { w: "克勤克儉", m: "既勤勞又節儉。" },
    { w: "判若兩人", m: "形容前後明顯不同。" },
    { w: "別出心裁", m: "獨出巧思，與眾不同。" },
    { w: "否極泰來", m: "比喻情況由壞逐漸好轉。" },
    { w: "含辛茹苦", m: "形容忍受辛苦，歷盡艱辛。" },
    { w: "坐井觀天", m: "比喻眼界狹小，見識不廣。" },
    { w: "完璧歸趙", m: "比喻物歸原主，完好無損。" },
    { w: "宏圖大展", m: "祝賀人發展宏大遠景的用語。" },
    { w: "志同道合", m: "彼此志趣相投，觀念一致。" },
    { w: "投筆從戎", m: "比喻棄文從武，投身軍旅。" },
    { w: "見賢思齊", m: "看到賢能的人，便想效法他。" },
    { w: "言不由衷", m: "心口不一，說的話不是發自內心。" },
    { w: "身歷其境", m: "親身經歷那種境地。" },
    { w: "每況愈下", m: "情況越來越壞。" },
    { w: "夜郎自大", m: "比喻人見識短淺，狂妄自大。" },
    { w: "奇貨可居", m: "比喻利用某種專長或條件來謀利。" },
    { w: "孤注一擲", m: "比喻危急時投入全部力量，作最後的冒險。" },
    { w: "空前絕後", m: "形容超越古今，獨一無二。" },
    { w: "臥薪嘗膽", m: "比喻刻苦自勵，發憤圖強。" },
    { w: "迎刃而解", m: "比喻問題很容易解決。" },
    { w: "金蟬脫殼", m: "比喻用計謀脫身。" },
    { w: "青出於藍", m: "比喻弟子勝過老師，或後輩優於前輩。" },
    { w: "信口開河", m: "不加思索地隨口亂說。" },
    { w: "前車之鑑", m: "比喻前人的失敗，可以作為後人的借鏡。" },
    { w: "品學兼優", m: "品行和學業都很好。" },
    { w: "按部就班", m: "依照順序步驟進行。" },
    { w: "洗心革面", m: "比喻徹底悔悟，改過自新。" },
    { w: "津津有味", m: "形容興趣濃厚的樣子。" },
    { w: "流連忘返", m: "形容留戀而不想離去。" },
    { w: "神采奕奕", m: "形容精神飽滿，容光煥發。" },
    { w: "退避三舍", m: "比喻主動退讓，不與人爭。" },
    { w: "班門弄斧", m: "比喻在行家面前賣弄本事。" },
    { w: "鬼斧神工", m: "形容技藝精巧，非人工所能及。" },
    { w: "唯妙唯肖", m: "形容模仿得非常像。" },
    { w: "啞口無言", m: "遭人質問或駁斥時默不作聲。" },
    { w: "推陳出新", m: "剔除舊的，創造新的。" },
    { w: "揚眉吐氣", m: "形容擺脫壓抑心情後的興奮神情。" },
    { w: "提心吊膽", m: "形容心理上恐懼不安。" },
    { w: "畫龍點睛", m: "比喻繪畫、作文時在關鍵處加上一筆，使內容更生動。" },
    { w: "集思廣益", m: "集合眾人的智慧，廣泛吸收有益的意見。" },
    { w: "勢如破竹", m: "比喻作戰或工作進行順利，毫無阻礙。" },
    { w: "愛屋及烏", m: "比喻愛一個人也連帶關愛與他有關的人事物。" },
    { w: "義不容辭", m: "道義上不容許推辭。" },
    { w: "落井下石", m: "比喻乘人危急時，加以陷害。" },
    { w: "滔滔不絕", m: "形容說話連續而不間斷。" },
    { w: "熙熙攘攘", m: "形容人來人往，熱鬧擁擠。" },
    { w: "精益求精", m: "好還要更好。" },
    { w: "緣木求魚", m: "比喻方法錯誤，根本不可能達到目的。" },
    { w: "曇花一現", m: "比喻美好事物不容易保存，或事物稀有難得。" },
    { w: "熟能生巧", m: "熟練了自然能領悟出巧妙的竅門。" },
    { w: "燃眉之急", m: "比喻非常緊急的困境。" },
    { w: "獨樹一幟", m: "比喻自成一家，獨具風格。" },
    { w: "舉一反三", m: "列舉一例而能曉喻其他各事。" },
    { w: "錦上添花", m: "美上加美，喜上加喜。" },
    { w: "鞠躬盡瘁", m: "指恭敬謹慎，竭盡心力去效勞。" },
    { w: "聲東擊西", m: "比喻以虛張聲勢來轉移對方的注意力。" },
    { w: "臨渴掘井", m: "比喻事到臨頭才想辦法，已經來不及了。" },
    { w: "豁然開朗", m: "形容領悟了解。" },
    { w: "鍥而不捨", m: "比喻做事持之以恆，堅持不懈。" },
    { w: "雙管齊下", m: "比喻同時採用兩種辦法。" },
    { w: "難言之隱", m: "藏在內心難以說出口的事情。" },
    { w: "懸崖勒馬", m: "比喻到了危險邊緣，能及時醒悟回頭。" },
    { w: "爐火純青", m: "比喻學問、技術、修養達到完美的境地。" },
    { w: "權宜之計", m: "為因應某種時勢而暫採的變通辦法。" },
    { w: "驚弓之鳥", m: "比喻曾受打擊或驚嚇，遇事容易驚恐的人。" },
    { w: "蠶食鯨吞", m: "比喻強國兼併弱國，或大企業併吞小公司。" },
    { w: "讓棗推梨", m: "比喻兄弟間友愛。" },
    { w: "觀望不前", m: "置身事外，猶豫不決。" }
];

// --- 自動循環補足至 366 題 ---
let fullIdiomList = [...rawIdiomList];
while (fullIdiomList.length < 366) {
    fullIdiomList = fullIdiomList.concat(rawIdiomList);
}
// 截斷多餘的，確保剛好或超過
fullIdiomList = fullIdiomList.slice(0, 366);


// ==========================================
// 2. 深度拆字字典 (遞迴用)
// 包含一級拆解與二級拆解，確保能拆成 12 個
// ==========================================
const charMap = {
    // 數字與基礎
    "一": ["一"], "二": ["一", "一"], "三": ["一", "二"], "十": ["一", "丨"],
    "口": ["口"], "日": ["日"], "月": ["月"], "田": ["口", "十"], "目": ["目"], 
    "大": ["一", "人"], "人": ["人"], "又": ["又"], "力": ["力"], "工": ["工"],

    // 字根定義 (字典越豐富，拆解越細膩)
    "安": ["宀", "女"], "宀": ["丶", "冖"], "女": ["女"],
    "按": ["扌", "安"], "扌": ["一", "亅"], 
    "本": ["木", "一"], "木": ["十", "八"], 
    "不": ["一", "小"], "小": ["亅", "八"],
    "變": ["䜌", "攵"], "䜌": ["言", "絲"], "絲": ["糸", "糸"], "言": ["亠", "口"], "攵": ["𠂂", "乂"],
    "包": ["勹", "巳"], "羅": ["罒", "維"], "萬": ["艹", "禺"], "象": ["⺈", "口", "豕"],

    "大": ["一", "人"], "刀": ["刀"], "闊": ["門", "活"], "門": ["门"], "活": ["氵", "舌"], "舌": ["千", "口"],
    "斧": ["父", "斤"], "父": ["八", "乂"], "斤": ["厂", "T"], 
    "復": ["彳", "复"], "彳": ["丿", "亻"], "复": ["𠂉", "日", "夂"], "夂": ["夂"], "𠂉": ["丿", "一"],
    "始": ["女", "台"], "台": ["厶", "口"], "厶": ["厶"],
    "分": ["八", "刀"], "反": ["厂", "又"], "厂": ["厂"],
    "風": ["几", "虫"], "几": ["丿", "乙"], "虫": ["中", "、"],

    "功": ["工", "力"], "虧": ["虍", "隹"], "簣": ["竹", "貴"], "貴": ["中", "一", "貝"], "竹": ["⺮"],
    "瓜": ["瓜"], "李": ["木", "子"], "子": ["了", "一"], "下": ["一", "卜"], 

    "井": ["一", "廾"], "底": ["广", "氐"], "广": ["丶", "厂"], "氐": ["氏", "一"],
    "之": ["丶", "Z"], "蛙": ["虫", "圭"], "圭": ["土", "土"], "土": ["十", "一"],
    "力": ["力"], "爭": ["爫", "争"], "爫": ["丿", "aaa"], "争": ["𠂉", "亅"], 
    "上": ["卜", "一"], "游": ["氵", "方", "子"], "氵": ["丶", "冫"], "方": ["亠", "勹"],
    "老": ["土", "丿", "匕"], "馬": ["馬"], "識": ["言", "音", "戈"], "途": ["辶", "余"],

    "目": ["目"], "光": ["⺌", "兀"], "如": ["女", "口"], "豆": ["豆"],
    "亡": ["亠", "乚"], "羊": ["羊"], "補": ["衤", "甫"], "衤": ["丶", "礻"], "甫": ["一", "月", "丶"],
    "牢": ["宀", "牛"], "牛": ["牛"], 
    "名": ["夕", "口"], "列": ["歹", "刂"], "前": ["䒑", "月", "刂"], "茅": ["艹", "矛"],

    "半": ["丷", "一", "丨"], "途": ["辶", "余"], "廢": ["广", "發"], "發": ["癶", "弓", "殳"],
    "若": ["艹", "右"], "右": ["𠂇", "口"], "兩": ["一", "冂", "人人"],

    "三": ["一", "二"], "思": ["田", "心"], "而": ["而"], "行": ["彳", "亍"], "亍": ["一", "亅"],
    "手": ["手"], "釋": ["釆", "睪"], "卷": ["龹", "卩"],
    "四": ["囗", "儿"], "海": ["氵", "每"], "每": ["𠂉", "母"], "為": ["為"], "家": ["宀", "豕"],
    "水": ["亅", "7", "乀"],
    "山": ["山"],

    "未": ["一", "木"], "雨": ["雨"], "綢": ["糸", "周"], "糸": ["幺", "小"], "周": ["冂", "吉"],
    "繆": ["糸", "翏"], "翏": ["羽", "人"], "羽": ["习", "习"],
    "無": ["𠂉", "卌", "灬"], "窮": ["穴", "身", "弓"],

    "一": ["一"], "元": ["二", "儿"], "儿": ["丿", "乚"],
    "遺": ["辶", "貴"], "辶": ["丶", "辶_body"], "餘": ["飠", "余"], "飠": ["人", "良"], "余": ["人", "一", "木"],
    "左": ["𠂇", "工"], "右": ["𠂇", "口"], "逢": ["辶", "夆"], "源": ["氵", "原"], "原": ["厂", "泉"],
    "自": ["自"], "相": ["木", "目"], "矛": ["矛"], "盾": ["⺁", "目", "十"],
    "坐": ["人", "人", "土"], "觀": ["雚", "見"], "天": ["一", "大"],
    
    // 更多字根補充，確保能拆
    "心": ["心"], "革": ["廿", "中", "十"], "面": ["一", "囬"], "非": ["非"], "常": ["尚", "巾"],
    "身": ["身"], "體": ["骨", "豊"], "驗": ["馬", "僉"], "教": ["孝", "攵"], "育": ["亠", "月"],
    "流": ["氵", "㐬"], "連": ["辶", "車"], "返": ["辶", "反"]
};

// ==========================================
// 3. 核心邏輯：生成當日資料
// ==========================================

function getIdiomByDay(dayOfYear) {
    const index = (dayOfYear - 1) % fullIdiomList.length;
    const idiomData = fullIdiomList[index];

    // 遞迴拆解
    const parts = decomposeTo12(idiomData.w);

    return {
        id: dayOfYear,
        idiom: idiomData.w,
        hint: idiomData.m, 
        parts: parts
    };
}

/**
 * 核心演算法：將字串拆解，直到數量達到 12
 */
function decomposeTo12(str) {
    let currentParts = str.split('');
    let loopCount = 0;
    const MAX_LOOPS = 50;

    // 當部件不足 12 且還在安全迴圈內時，繼續拆
    while (currentParts.length < 12 && loopCount < MAX_LOOPS) {
        let hasSplit = false;
        
        for (let i = 0; i < currentParts.length; i++) {
            const char = currentParts[i];
            
            // 檢查字典是否有此字的拆解定義，且拆解後數量 > 1
            if (charMap[char] && charMap[char].length > 1) {
                const subParts = charMap[char];
                const netGain = subParts.length - 1;
                
                // 預判：如果拆了這個字，會不會超過 12 個？
                if (currentParts.length + netGain <= 12) {
                    currentParts.splice(i, 1, ...subParts);
                    hasSplit = true;
                    break; 
                }
            }
        }

        if (!hasSplit) {
            // 如果拆無可拆，隨機複製現有部件來填滿 (規則：必須填滿12)
            if (currentParts.length < 12) {
                 const randomPart = currentParts[Math.floor(Math.random() * currentParts.length)];
                 currentParts.push(randomPart);
            } else {
                break;
            }
        }
        loopCount++;
    }

    // 最後保險：若仍不足則補齊
    while (currentParts.length < 12) {
        currentParts.push(currentParts[currentParts.length - 1]);
    }
    
    return currentParts.slice(0, 12);
}